# [红黑树](https://zhuanlan.zhihu.com/p/31805309)
先抛出问题： 红黑树的特性和优势，什么情况下需要变色，什么情况下需要偏转  
1. 插入操作：  
将新节点的颜色设为红色，然后以二叉排序树的插入方法插入到红黑树中去。之所以将新插入的节点设为红色，是因为：如果设为黑色，会导致根到叶子的路径有一条路上会多出一个额外的黑节点，这个很难调整。而红色所导致出现两个连续红色节点的冲突，可以通过颜色调换和树旋转来调整  

### 先了解一下二叉查找树(Binary Search Tree)  
- 二叉查找树的特性  
    1. 左子树上所有结点的值均小于或等于它的根结点的值  
    2. 右子树上所有结点的值均大于或等于它的根结点的值  
    3. 左右子树也分别为二叉排序树  
![典型二叉查找树](https://pic2.zhimg.com/80/v2-13716ce8772e77b8f448408a60dee6ad_hd.jpg)  

- 优点  
    1. 典型的二分法查找，最大次数等于树的高度  
    2. 插入的时候的时间复杂度和查找一样都是 log(n)  

- 缺点  
    1. 会出现特殊的情况，使得性能变差，几乎变成线性  
![瘸腿二叉查找树](https://pic1.zhimg.com/80/v2-38e1125c3caa7bc83723f70f28533638_hd.jpg)  

**红黑树可以解决二叉树不平衡的问题**

### 红黑树(red black tree)是一种自平衡的二叉查找树。除了二叉查找树的所有特性外，还有如下附加属性
1. 节点是红色或黑色  
2. 根节点是黑色  
3. 每个叶子节点都是黑色的空节点(NIL节点)
4. 每个红色节点的两个子节点都是黑色。(从每个叶子到根的所有路径上不能有两个连续的红色节点)  
5. 从任一节点到其每个叶子的所有路径都包含相同数目的黑色节点  
![典型的红黑树](https://pic3.zhimg.com/80/v2-a183459a6010189e8b2b9415d85e550e_hd.jpg)  

- 这些规则的限制，保证了红黑树的自平衡  
- 红黑树从根到叶子的最长路径不会超过最短路径的两倍  
- 当插入或删除节点的时候，红黑树的规则可能被打破。这时候就需要做出调整，维持红黑树的规则  
    1. 不会破坏平衡  
    ![维持平衡](https://pic2.zhimg.com/80/v2-4e1da1dd37311a8f6d31e809afb9fc59_hd.jpg)    
    2. 破坏平衡(破坏了规则4，每个节点的两个子节点都是黑色)  
    ![破坏平衡](https://pic4.zhimg.com/80/v2-c90fee5bc6422c16dcd13e890ff4a74f_hd.jpg)  
- 可以通过[变色]和[旋转]来调整平衡，旋转分为[左][右]  

#### 变色  
> 25不是根节点，只是另一个数的一部分。
1. 因为21和22连续出现了红色，破坏了规则4，所以把节点22从红色变成黑色  
2. 这样凭空出现的黑色节点打破了规则5，所以需要把节点25从黑色变成红色  
3. 但是这样25和27又连续出现了红色节点，需要把27从红色编程黑色   
![变色1](https://pic4.zhimg.com/80/v2-d4827e3f1f5f9556c01ea8ec6982775b_hd.jpg)  
![变色2](https://pic2.zhimg.com/80/v2-29e61d08dec823db494afd92e8c9666d_hd.jpg)  
![变色3](https://pic1.zhimg.com/80/v2-ded4f2cf7b64cb0106960f049bff2e84_hd.jpg)  

#### 左旋转  
逆时针旋转红黑树的两个节点，使得父节点被自己的右孩子取代，而自己成为了自己的左孩子  
![左旋转](https://pic1.zhimg.com/80/v2-6cb033d91d7379b22d2dcd3d0f201c54_hd.jpg)  
> 图中Y取代了X  

#### 右旋转  
顺时针旋转红黑树的两个节点，使得父节点被自己的左孩子取代，而自己成为了自己的右孩子  
![右旋转](https://pic4.zhimg.com/80/v2-24f4d2e75d0ccf54aeb6c2d5b36092f7_hd.jpg)  
> 图中，Y取代了X  

### 已晕，变色和旋转的取舍  
以下图为例  
![eg](https://pic4.zhimg.com/80/v2-c90fee5bc6422c16dcd13e890ff4a74f_hd.jpg)  
1. 变色：把节点25及其下方的节点变色  
2. 此时17和25是两个连续的红色节点，为了维持红黑树的规则，将8和17进行变色，这样就形成了新的红黑树  
3. 
![变色1](https://pic1.zhimg.com/80/v2-14c23802cc0a4188c9d988c99e130458_hd.jpg)  
![变色2](https://pic3.zhimg.com/80/v2-5710d043b731d272c35e864bb1026996_hd.jpg)  